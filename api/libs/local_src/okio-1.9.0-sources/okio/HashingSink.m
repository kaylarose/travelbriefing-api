//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: build/libs_raw/okio-1.9.0-sources/okio/HashingSink.java
//

#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "java/lang/AssertionError.h"
#include "java/lang/Math.h"
#include "java/security/MessageDigest.h"
#include "java/security/NoSuchAlgorithmException.h"
#include "okio/Buffer.h"
#include "okio/ByteString.h"
#include "okio/ForwardingSink.h"
#include "okio/HashingSink.h"
#include "okio/Segment.h"
#include "okio/Sink.h"
#include "okio/Util.h"

@interface OkioHashingSink () {
 @public
  JavaSecurityMessageDigest *messageDigest_;
}

- (instancetype)initWithOkioSink:(id<OkioSink>)sink
                    withNSString:(NSString *)algorithm;

@end

J2OBJC_FIELD_SETTER(OkioHashingSink, messageDigest_, JavaSecurityMessageDigest *)

__attribute__((unused)) static void OkioHashingSink_initWithOkioSink_withNSString_(OkioHashingSink *self, id<OkioSink> sink, NSString *algorithm);

__attribute__((unused)) static OkioHashingSink *new_OkioHashingSink_initWithOkioSink_withNSString_(id<OkioSink> sink, NSString *algorithm) NS_RETURNS_RETAINED;

__attribute__((unused)) static OkioHashingSink *create_OkioHashingSink_initWithOkioSink_withNSString_(id<OkioSink> sink, NSString *algorithm);

@implementation OkioHashingSink

+ (OkioHashingSink *)md5WithOkioSink:(id<OkioSink>)sink {
  return OkioHashingSink_md5WithOkioSink_(sink);
}

+ (OkioHashingSink *)sha1WithOkioSink:(id<OkioSink>)sink {
  return OkioHashingSink_sha1WithOkioSink_(sink);
}

+ (OkioHashingSink *)sha256WithOkioSink:(id<OkioSink>)sink {
  return OkioHashingSink_sha256WithOkioSink_(sink);
}

- (instancetype)initWithOkioSink:(id<OkioSink>)sink
                    withNSString:(NSString *)algorithm {
  OkioHashingSink_initWithOkioSink_withNSString_(self, sink, algorithm);
  return self;
}

- (void)writeWithOkioBuffer:(OkioBuffer *)source
                   withLong:(jlong)byteCount {
  OkioUtil_checkOffsetAndCountWithLong_withLong_withLong_(((OkioBuffer *) nil_chk(source))->size_, 0, byteCount);
  jlong hashedCount = 0;
  for (OkioSegment *s = source->head_; hashedCount < byteCount; s = s->next_) {
    jint toHash = (jint) JavaLangMath_minWithLong_withLong_(byteCount - hashedCount, ((OkioSegment *) nil_chk(s))->limit_ - s->pos_);
    [((JavaSecurityMessageDigest *) nil_chk(messageDigest_)) updateWithByteArray:s->data_ withInt:s->pos_ withInt:toHash];
    hashedCount += toHash;
  }
  [super writeWithOkioBuffer:source withLong:byteCount];
}

- (OkioByteString *)hash__ {
  IOSByteArray *result = [((JavaSecurityMessageDigest *) nil_chk(messageDigest_)) digest];
  return OkioByteString_ofWithByteArray_(result);
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "md5WithOkioSink:", "LOkioHashingSink;", 0x9, 0, 1, -1, -1, -1, -1 },
    { "sha1WithOkioSink:", "LOkioHashingSink;", 0x9, 2, 1, -1, -1, -1, -1 },
    { "sha256WithOkioSink:", "LOkioHashingSink;", 0x9, 3, 1, -1, -1, -1, -1 },
    { "initWithOkioSink:withNSString:", NULL, 0x2, -1, 4, -1, -1, -1, -1 },
    { "writeWithOkioBuffer:withLong:", "V", 0x1, 5, 6, 7, -1, -1, -1 },
    { "hash__", "LOkioByteString;", 0x1, 8, -1, -1, -1, -1, -1 },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "messageDigest_", "LJavaSecurityMessageDigest;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "md5", "LOkioSink;", "sha1", "sha256", "LOkioSink;LNSString;", "write", "LOkioBuffer;J", "LJavaIoIOException;", "hash" };
  static const J2ObjcClassInfo _OkioHashingSink = { "HashingSink", "okio", ptrTable, methods, fields, 7, 0x11, 6, 1, -1, -1, -1, -1, -1 };
  return &_OkioHashingSink;
}

@end

OkioHashingSink *OkioHashingSink_md5WithOkioSink_(id<OkioSink> sink) {
  OkioHashingSink_initialize();
  return new_OkioHashingSink_initWithOkioSink_withNSString_(sink, @"MD5");
}

OkioHashingSink *OkioHashingSink_sha1WithOkioSink_(id<OkioSink> sink) {
  OkioHashingSink_initialize();
  return new_OkioHashingSink_initWithOkioSink_withNSString_(sink, @"SHA-1");
}

OkioHashingSink *OkioHashingSink_sha256WithOkioSink_(id<OkioSink> sink) {
  OkioHashingSink_initialize();
  return new_OkioHashingSink_initWithOkioSink_withNSString_(sink, @"SHA-256");
}

void OkioHashingSink_initWithOkioSink_withNSString_(OkioHashingSink *self, id<OkioSink> sink, NSString *algorithm) {
  OkioForwardingSink_initWithOkioSink_(self, sink);
  @try {
    self->messageDigest_ = JavaSecurityMessageDigest_getInstanceWithNSString_(algorithm);
  }
  @catch (JavaSecurityNoSuchAlgorithmException *e) {
    @throw new_JavaLangAssertionError_init();
  }
}

OkioHashingSink *new_OkioHashingSink_initWithOkioSink_withNSString_(id<OkioSink> sink, NSString *algorithm) {
  J2OBJC_NEW_IMPL(OkioHashingSink, initWithOkioSink_withNSString_, sink, algorithm)
}

OkioHashingSink *create_OkioHashingSink_initWithOkioSink_withNSString_(id<OkioSink> sink, NSString *algorithm) {
  J2OBJC_CREATE_IMPL(OkioHashingSink, initWithOkioSink_withNSString_, sink, algorithm)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OkioHashingSink)
